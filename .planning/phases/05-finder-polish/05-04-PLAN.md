---
phase: 05-finder-polish
plan: 04
type: execute
wave: 2
depends_on:
  - "05-01"
files_modified:
  - src/finder.rs
  - styles.css
autonomous: true

must_haves:
  truths:
    - "Typing in search field filters displayed files"
    - "Search filtering works in all view modes"
    - "Path bar shows current location as clickable breadcrumbs"
    - "Clicking a path bar segment navigates to that location"
  artifacts:
    - path: "src/finder.rs"
      provides: "Search filtering and path bar"
      contains: "search_query"
    - path: "styles.css"
      provides: "Path bar styling"
      contains: ".finder-pathbar"
  key_links:
    - from: "search input"
      to: "search_query signal"
      via: "on:input handler"
      pattern: "set_search_query"
    - from: "filtered_files Memo"
      to: "search_query signal"
      via: "filter closure"
      pattern: "search_query\\.get\\(\\)"
---

<objective>
Implement search filtering and path bar for Finder.

Purpose: REQ-005.8 requires functional search, REQ-005.6 requires path bar.
Output: Working search that filters current view, clickable breadcrumb path bar.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-finder-polish/05-RESEARCH.md
@.planning/phases/05-finder-polish/05-01-SUMMARY.md

@src/finder.rs
@styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add search filtering</name>
  <files>src/finder.rs</files>
  <action>
Add search functionality to filter files in the current view.

1. Add a search_query signal:
```rust
let (search_query, set_search_query) = signal(String::new());
```

2. Create a filtered_files Memo that filters based on search_query:
```rust
let filtered_files = Memo::new(move |_| {
    let query = search_query.get().to_lowercase();
    let all_files = files.get();

    if query.is_empty() {
        all_files
    } else {
        all_files.into_iter()
            .filter(|f| f.name.to_lowercase().contains(&query))
            .collect()
    }
});
```

3. Wire the search input to update search_query:
```rust
<input
    type="text"
    placeholder="Search"
    class="finder-search-input"
    on:input=move |ev| {
        set_search_query.set(event_target_value(&ev));
    }
    prop:value=move || search_query.get()
/>
```

4. Update all view modes to use filtered_files instead of files:
- Icon view: Change `files.get()` to `filtered_files.get()`
- List view: Same change
- Column view: Filter should apply to the rightmost column or current path

Note: May need to add `use leptos::prelude::event_target_value;` if not already imported.
  </action>
  <verify>Run `trunk serve`, type in search field, verify files are filtered in current view</verify>
  <done>Search filters files in all view modes</done>
</task>

<task type="auto">
  <name>Task 2: Add path bar component</name>
  <files>src/finder.rs</files>
  <action>
Add a path bar component that shows the current path as clickable breadcrumbs.

Insert the path bar between the content area and the status bar.

Path bar component:
```rust
// Path bar - between content and status bar
<div class="finder-pathbar">
    {move || {
        let path = current_path.get();
        if path == "/" {
            // Just show root
            view! {
                <button
                    class="pathbar-segment"
                    on:click=move |_| navigate_to("/".to_string())
                >
                    <span class="pathbar-icon">"ðŸ’¾"</span>
                    <span>"Macintosh HD"</span>
                </button>
            }.into_any()
        } else {
            // Build breadcrumb segments
            let parts: Vec<&str> = path.split('/').filter(|s| !s.is_empty()).collect();
            let segments: Vec<_> = parts.iter().enumerate().map(|(i, part)| {
                let full_path = if i == 0 {
                    format!("/{}", part)
                } else {
                    format!("/{}", parts[0..=i].join("/"))
                };
                let path_for_click = full_path.clone();
                let is_last = i == parts.len() - 1;
                let display_name = if i == 0 && *part == "Applications" {
                    "Applications"
                } else {
                    *part
                };

                view! {
                    <>
                        <button
                            class="pathbar-segment"
                            on:click=move |_| navigate_to(path_for_click.clone())
                        >
                            {display_name}
                        </button>
                        {if !is_last {
                            Some(view! { <span class="pathbar-separator">"â€º"</span> })
                        } else {
                            None
                        }}
                    </>
                }
            }).collect();

            // Prepend root
            view! {
                <>
                    <button
                        class="pathbar-segment"
                        on:click=move |_| navigate_to("/".to_string())
                    >
                        <span class="pathbar-icon">"ðŸ’¾"</span>
                        <span>"Macintosh HD"</span>
                    </button>
                    <span class="pathbar-separator">"â€º"</span>
                    {segments}
                </>
            }.into_any()
        }
    }}
</div>
```

Note: The navigate_to closure needs to be cloned or available in scope. May need to wrap it.
  </action>
  <verify>Run `trunk serve`, navigate to a folder, verify path bar shows breadcrumb trail</verify>
  <done>Path bar shows current location as clickable breadcrumbs</done>
</task>

<task type="auto">
  <name>Task 3: Add path bar CSS styling</name>
  <files>styles.css</files>
  <action>
Add CSS for the path bar after the status bar styles:

```css
/* Finder Path Bar */
.finder-pathbar {
    height: 24px;
    background: var(--finder-toolbar-end);
    border-top: 1px solid var(--finder-toolbar-border);
    border-bottom: 1px solid var(--finder-toolbar-border);
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 4px;
    overflow: hidden;
}

.pathbar-segment {
    display: flex;
    align-items: center;
    gap: 4px;
    background: transparent;
    border: none;
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 11px;
    color: var(--finder-text);
    cursor: pointer;
    white-space: nowrap;
    font-family: inherit;
}

.pathbar-segment:hover {
    background: var(--finder-hover);
}

.pathbar-segment:active {
    background: var(--finder-selected);
}

.pathbar-icon {
    font-size: 12px;
}

.pathbar-separator {
    color: var(--finder-text-muted);
    font-size: 10px;
    flex-shrink: 0;
}
```

The path bar should:
- Be positioned between content and status bar
- Have clickable segments that highlight on hover
- Show ">" separators between segments
- Scroll or truncate if path is too long
  </action>
  <verify>Run `trunk serve`, verify path bar styling matches macOS Finder</verify>
  <done>Path bar has proper macOS-style appearance</done>
</task>

</tasks>

<verification>
- `trunk build` completes without errors
- Typing in search filters visible files
- Search works in icon view, list view, and column view
- Path bar displays current path as breadcrumbs
- Clicking a path bar segment navigates to that folder
- Path bar updates when navigating
</verification>

<success_criteria>
- REQ-005.6 satisfied: Path bar shows current location
- REQ-005.8 satisfied: Functional search filters current view
- Both features are visually consistent with macOS Finder
</success_criteria>

<output>
After completion, create `.planning/phases/05-finder-polish/05-04-SUMMARY.md`
</output>
