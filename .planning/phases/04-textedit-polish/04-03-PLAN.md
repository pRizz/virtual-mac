---
phase: 04-textedit-polish
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/textedit.rs
  - styles.css
autonomous: false

must_haves:
  truths:
    - "User sees word and character count in status bar"
    - "Toolbar has polished macOS appearance"
    - "TextEdit visually matches macOS TextEdit"
  artifacts:
    - path: "src/textedit.rs"
      provides: "Status bar with live word/character count"
      contains: "word_count"
    - path: "styles.css"
      provides: "Refined toolbar styling"
      contains: "textedit-toolbar"
  key_links:
    - from: "src/textedit.rs"
      to: "document content"
      via: "input event handler for counting"
      pattern: "on:input"
---

<objective>
Add status bar with word/character count, refine toolbar appearance to match macOS TextEdit, and perform final visual verification.

Purpose: Cover REQ-004.1 completion (toolbar polish) and add professional status bar. Final verification ensures visual fidelity.
Output: Polished TextEdit matching macOS appearance with functional status bar.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-textedit-polish/04-RESEARCH.md
@.planning/phases/04-textedit-polish/04-01-SUMMARY.md
@.planning/phases/04-textedit-polish/04-02-SUMMARY.md
@src/textedit.rs
@styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add status bar with word and character count</name>
  <files>src/textedit.rs</files>
  <action>
    1. Add signals for word and character count:
       ```rust
       let (word_count, set_word_count) = signal(0usize);
       let (char_count, set_char_count) = signal(0usize);
       ```

    2. Create a node reference for the document:
       ```rust
       let doc_ref = NodeRef::<leptos::html::Div>::new();
       ```

    3. Create content update handler to count words/characters:
       ```rust
       let update_counts = move |_| {
           if let Some(el) = doc_ref.get() {
               let text = el.inner_text();
               let chars = text.chars().count();
               let words = text.split_whitespace().count();
               set_char_count.set(chars);
               set_word_count.set(words);
           }
       };
       ```

    4. Add node_ref and on:input to the document div:
       ```rust
       <div
           class="textedit-document"
           contenteditable="true"
           node_ref=doc_ref
           on:input=update_counts
           style=move || format!("font-size: {}px;", font_size.get())
       >
       ```

    5. Update the status bar to show counts:
       ```rust
       <div class="textedit-statusbar">
           <span class="textedit-statusbar-item">
               {move || format!("{} words", word_count.get())}
           </span>
           <span class="textedit-statusbar-separator"></span>
           <span class="textedit-statusbar-item">
               {move || format!("{} characters", char_count.get())}
           </span>
       </div>
       ```

    6. Add required use statements if not present:
       ```rust
       use leptos::prelude::*;
       use leptos::html::Div;  // for NodeRef type
       ```
  </action>
  <verify>Run `trunk serve`, test:
    - Status bar shows "0 words" and "0 characters" initially
    - Typing updates counts in real-time
    - Word count is accurate (splits on whitespace)
    - Character count includes spaces</verify>
  <done>TextEdit shows live word and character count in status bar</done>
</task>

<task type="auto">
  <name>Task 2: Refine toolbar visual appearance</name>
  <files>styles.css</files>
  <action>
    1. Update toolbar styling to closer match macOS TextEdit:
       ```css
       .textedit-toolbar {
           display: flex;
           align-items: center;
           padding: 6px 12px;
           background: linear-gradient(180deg, #fafafa 0%, #e8e8e8 100%);
           border-bottom: 1px solid #b8b8b8;
           gap: 6px;
           min-height: 36px;
           flex-wrap: wrap;
       }
       ```

    2. Refine button styling for more authentic macOS feel:
       ```css
       .textedit-btn {
           min-width: 26px;
           height: 22px;
           padding: 0 6px;
           border: 1px solid #c0c0c0;
           background: linear-gradient(180deg, #fefefe 0%, #f0f0f0 100%);
           border-radius: 3px;
           cursor: pointer;
           font-size: 12px;
           font-weight: 500;
           color: #333;
           display: flex;
           align-items: center;
           justify-content: center;
           transition: all 0.1s;
           box-shadow: 0 1px 1px rgba(0, 0, 0, 0.04);
       }

       .textedit-btn:hover {
           background: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%);
           border-color: #a0a0a0;
       }

       .textedit-btn:active {
           background: linear-gradient(180deg, #e8e8e8 0%, #d8d8d8 100%);
           box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
       }

       .textedit-btn.active {
           background: linear-gradient(180deg, #d8d8d8 0%, #c8c8c8 100%);
           border-color: #a0a0a0;
           box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15);
       }
       ```

    3. Refine separator:
       ```css
       .textedit-toolbar-separator {
           width: 1px;
           height: 18px;
           background: linear-gradient(180deg, transparent 0%, #c0c0c0 20%, #c0c0c0 80%, transparent 100%);
           margin: 0 2px;
       }
       ```

    4. Refine select dropdowns:
       ```css
       .textedit-select {
           height: 22px;
           padding: 0 6px;
           border: 1px solid #c0c0c0;
           background: linear-gradient(180deg, #fefefe 0%, #f0f0f0 100%);
           border-radius: 3px;
           font-size: 11px;
           color: #333;
           cursor: pointer;
           outline: none;
           font-family: -apple-system, BlinkMacSystemFont, sans-serif;
           box-shadow: 0 1px 1px rgba(0, 0, 0, 0.04);
           -webkit-appearance: none;
           appearance: none;
           padding-right: 18px;
           background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='4' viewBox='0 0 8 4'%3E%3Cpath fill='%23666' d='M0 0l4 4 4-4z'/%3E%3C/svg%3E");
           background-repeat: no-repeat;
           background-position: right 6px center;
       }
       ```

    5. Refine statusbar styling:
       ```css
       .textedit-statusbar {
           height: 20px;
           background: linear-gradient(180deg, #f6f6f6 0%, #ececec 100%);
           border-top: 1px solid #c8c8c8;
           display: flex;
           align-items: center;
           justify-content: flex-end;
           padding: 0 12px;
           font-size: 11px;
           color: #666;
           gap: 8px;
       }

       .textedit-statusbar-item {
           white-space: nowrap;
       }

       .textedit-statusbar-separator {
           width: 1px;
           height: 10px;
           background: #c8c8c8;
       }
       ```

    6. Add dark mode variants:
       ```css
       [data-theme="dark"] .textedit-toolbar {
           background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
           border-bottom-color: #2a2a2a;
       }

       [data-theme="dark"] .textedit-btn {
           background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
           border-color: #3a3a3a;
           color: #e0e0e0;
       }

       [data-theme="dark"] .textedit-btn:hover {
           background: linear-gradient(180deg, #6a6a6a 0%, #5a5a5a 100%);
       }

       [data-theme="dark"] .textedit-btn.active {
           background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
       }

       [data-theme="dark"] .textedit-select {
           background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 100%);
           border-color: #3a3a3a;
           color: #e0e0e0;
           background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='4' viewBox='0 0 8 4'%3E%3Cpath fill='%23999' d='M0 0l4 4 4-4z'/%3E%3C/svg%3E");
       }

       [data-theme="dark"] .textedit-statusbar {
           background: linear-gradient(180deg, #3a3a3a 0%, #2d2d2d 100%);
           border-top-color: #1a1a1a;
           color: #999;
       }
       ```
  </action>
  <verify>Visual inspection of toolbar:
    - Buttons have subtle gradients and shadows
    - Dropdowns have arrow indicators
    - Toolbar has professional macOS appearance
    - Status bar is refined and subtle
    - Dark mode styling works correctly</verify>
  <done>Toolbar and statusbar have polished macOS-style appearance</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete TextEdit Polish - Toolbar, document appearance, color pickers, status bar</what-built>
  <how-to-verify>
    1. Run `trunk serve` and open the TextEdit app from the dock
    2. Visual check - toolbar appearance:
       - Font family dropdown visible and functional
       - Font size dropdown visible and functional
       - B, I, U buttons present and working
       - Alignment buttons (4) present and working
       - Text color picker (A with color bar) present
       - Highlight color picker (A with highlight) present
    3. Visual check - document appearance:
       - Gray background around document
       - White page with shadow
       - Proper margins (looks like a real document)
    4. Functional tests:
       - Type some text, verify word/character count updates
       - Select text, apply bold, verify B button shows active
       - Select text, change font family, verify text updates
       - Select text, change text color, verify color applies
       - Select text, apply highlight, verify highlight applies
       - Click alignment buttons, verify paragraph aligns
    5. Compare with macOS TextEdit if available - should be visually similar
  </how-to-verify>
  <resume-signal>Type "approved" if TextEdit matches expectations, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. TextEdit opens from dock without errors
2. All toolbar controls functional
3. Document has page-like appearance
4. Status bar shows accurate counts
5. Visual polish matches macOS aesthetic
</verification>

<success_criteria>
- REQ-004.1 (toolbar) complete - all controls present and polished
- REQ-004.2 (document style) verified
- REQ-004.3 (font family) verified
- REQ-004.4 (font size) verified
- REQ-004.5 (B/I/U) verified
- REQ-004.6 (alignment) verified
- REQ-004.7 (color pickers) verified
- REQ-004.9 (cursor/selection) verified
- REQ-004.10 (execCommand) confirmed working (not replaced)
- REQ-004.8 (ruler) acknowledged as optional, not implemented
</success_criteria>

<output>
After completion, create `.planning/phases/04-textedit-polish/04-03-SUMMARY.md`
</output>
