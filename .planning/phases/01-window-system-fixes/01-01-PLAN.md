---
phase: 01-window-system-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/window_manager.rs
  - styles.css
autonomous: true

must_haves:
  truths:
    - "Windows cannot be dragged above the menu bar"
    - "Window titles appear centered relative to full window width"
    - "Initial Finder window uses AppType::Finder"
  artifacts:
    - path: "src/window_manager.rs"
      provides: "Window drag bounds enforcement and Finder AppType fix"
      contains: "MENU_BAR_HEIGHT"
    - path: "styles.css"
      provides: "Window title centering fix"
      contains: "position: absolute"
  key_links:
    - from: "src/window_manager.rs"
      to: "DragOperation::Move handling"
      via: "min y constraint using MENU_BAR_HEIGHT"
      pattern: "MENU_BAR_HEIGHT"
---

<objective>
Fix three window system issues: drag bounds, title centering, and Finder AppType.

Purpose: These are core window system fixes that improve usability and correctness
Output: Modified window_manager.rs and styles.css with all three fixes applied
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix window drag bounds (FIX-001)</name>
  <files>src/window_manager.rs</files>
  <action>
    Add a constant for menu bar height at the top of the file:
    ```rust
    /// Menu bar height in pixels (matches CSS --menubar-height)
    const MENU_BAR_HEIGHT: f64 = 25.0;
    ```

    Modify the window move logic in TWO places:

    1. In the `on_mouse_move` closure (around line 476-478):
       Change:
       ```rust
       win.x = (window_start_x + dx).max(0.0);
       win.y = (window_start_y + dy).max(0.0);
       ```
       To:
       ```rust
       win.x = (window_start_x + dx).max(0.0);
       win.y = (window_start_y + dy).max(MENU_BAR_HEIGHT);
       ```

    2. In the document-level `doc_mousemove_handler` closure (around line 562-564):
       Change:
       ```rust
       win.x = (window_start_x + dx).max(0.0);
       win.y = (window_start_y + dy).max(0.0);
       ```
       To:
       ```rust
       win.x = (window_start_x + dx).max(0.0);
       win.y = (window_start_y + dy).max(MENU_BAR_HEIGHT);
       ```

    This ensures windows cannot be dragged above the 25px menu bar in either handler.
  </action>
  <verify>
    Run `cargo check` to verify the code compiles.
    Run `trunk serve` and drag a window upward - it should stop at the menu bar.
  </verify>
  <done>Windows cannot be dragged above y=25 (menu bar height)</done>
</task>

<task type="auto">
  <name>Task 2: Fix window title centering (FIX-002)</name>
  <files>styles.css</files>
  <action>
    Modify the `.window-title` CSS rule (around lines 271-282) to use absolute positioning for true centering.

    Change from:
    ```css
    .window-title {
        flex: 1;
        text-align: center;
        font-size: 13px;
        font-weight: 500;
        color: var(--window-title-color);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        margin: 0 8px;
    }
    ```

    To:
    ```css
    .window-title {
        position: absolute;
        left: 0;
        right: 0;
        text-align: center;
        font-size: 13px;
        font-weight: 500;
        color: var(--window-title-color);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        pointer-events: none;
    }
    ```

    Also ensure `.window-titlebar` has `position: relative` (it should already, but verify or add if missing).

    The `pointer-events: none` allows clicks to pass through to the titlebar for dragging.
  </action>
  <verify>
    Run `trunk serve` and observe window titles at various widths.
    The title should appear centered relative to the full window width, not offset by the traffic lights.
  </verify>
  <done>Window titles are centered relative to full window width at all sizes</done>
</task>

<task type="auto">
  <name>Task 3: Fix initial Finder AppType (FIX-003)</name>
  <files>src/window_manager.rs</files>
  <action>
    Modify the initial windows vector (around line 144) to use `new_with_app` for the Finder window.

    Change:
    ```rust
    let (windows, set_windows) = signal(vec![
        WindowState::new(1, "Finder", 100.0, 80.0, 600.0, 400.0),
        WindowState::new_with_app(2, "Calculator", 200.0, 150.0, 250.0, 420.0, AppType::Calculator),
        // ...
    ]);
    ```

    To:
    ```rust
    let (windows, set_windows) = signal(vec![
        WindowState::new_with_app(1, "Finder", 100.0, 80.0, 600.0, 400.0, AppType::Finder),
        WindowState::new_with_app(2, "Calculator", 200.0, 150.0, 250.0, 420.0, AppType::Calculator),
        // ...
    ]);
    ```

    This ensures the initial Finder window uses AppType::Finder instead of AppType::Generic, giving it correct title bar behavior and content rendering.
  </action>
  <verify>
    Run `cargo check` to verify compilation.
    Run `trunk serve` and check that the initial Finder window:
    - Shows the Finder component content (not generic "Window: Finder" text)
    - Has proper Finder styling applied
  </verify>
  <done>Initial Finder window uses AppType::Finder and renders Finder component</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cargo build --release` succeeds
2. Windows cannot be dragged above menu bar (y >= 25)
3. Window titles are visually centered at various widths
4. Finder window shows actual Finder UI, not generic content
</verification>

<success_criteria>
- FIX-001: Dragging windows upward stops at menu bar boundary
- FIX-002: Title text is centered relative to full window width
- FIX-003: Initial Finder uses AppType::Finder (visible as proper Finder UI)
</success_criteria>

<output>
After completion, create `.planning/phases/01-window-system-fixes/01-01-SUMMARY.md`
</output>
