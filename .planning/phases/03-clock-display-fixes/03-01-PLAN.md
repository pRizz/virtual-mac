---
phase: 03-clock-display-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/menu_bar.rs
  - src/desktop.rs
autonomous: true

must_haves:
  truths:
    - "Clock shows time as H:MM:SS AM/PM (e.g., 2:04:30 PM)"
    - "Seconds update in real-time (every second)"
    - "Build timestamp shows 'Built at {timestamp}'"
  artifacts:
    - path: "src/menu_bar.rs"
      provides: "Corrected clock format with seconds"
      contains: "format!.*:.*:.*AM|PM"
    - path: "src/desktop.rs"
      provides: "Build timestamp with prefix"
      contains: "Built at"
  key_links:
    - from: "src/menu_bar.rs"
      to: "menu bar clock display"
      via: "get_current_time() called every second"
      pattern: "get_current_time"
---

<objective>
Fix clock format to show "H:MM:SS AM/PM", add seconds display, and add "Built at " prefix to build timestamp.

Purpose: Complete v1.1 System Polish milestone by fixing the remaining display bugs (FIX-007, FIX-008, FIX-009).
Output: Corrected clock and build timestamp displays matching macOS styling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

Reference files:
@src/menu_bar.rs (lines 481-516 - get_current_time function)
@src/desktop.rs (lines 124-127 - build info display)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix clock format and add seconds</name>
  <files>src/menu_bar.rs</files>
  <action>
Fix the `get_current_time()` function (around line 481) to display time as "H:MM:SS AM/PM":

Current broken format (line 495-496):
```rust
format!("{} {:02} {}", get_day_abbrev(&date), display_hours, period)
    + &format!(":{:02}", minutes)
```
This produces "Wed 2 PM:04" (wrong - period before minutes).

Replace with corrected format that:
1. Gets seconds from the Date object: `let seconds = date.get_seconds();`
2. Formats as: `"{day} {hours}:{minutes:02}:{seconds:02} {period}"`

The corrected code should look like:
```rust
let seconds = date.get_seconds();
format!(
    "{} {}:{:02}:{:02} {}",
    get_day_abbrev(&date),
    display_hours,
    minutes,
    seconds,
    period
)
```

Also update the non-wasm fallback (line 500) to match: `"Wed 12:00:00 PM".to_string()`

Requirements satisfied:
- FIX-008.1: Time displays as "H:MM AM/PM" format (now H:MM:SS AM/PM)
- FIX-008.2: Minutes always two digits
- FIX-009.1: Clock displays seconds
- FIX-009.2: Updates every second (already handled by existing setInterval)
  </action>
  <verify>
Run `trunk build` and verify it compiles without errors.
Check the format string produces correct output pattern.
  </verify>
  <done>
Clock displays as "Wed 2:04:30 PM" format with seconds, updating every second.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add "Built at" prefix to build timestamp</name>
  <files>src/desktop.rs</files>
  <action>
Modify the build timestamp display (line 126) to add the "Built at " prefix.

Current code:
```rust
<span class="build-time">{env!("BUILD_TIME")}</span>
```

Change to:
```rust
<span class="build-time">"Built at "{env!("BUILD_TIME")}</span>
```

In Leptos/RSX, adjacent string literals and expressions are concatenated in the view, so this will render as "Built at 2026-01-17 12:00:00 UTC".

Requirements satisfied:
- FIX-007.1: Version display shows "Built at {timestamp}"
  </action>
  <verify>
Run `trunk build` and verify it compiles.
Inspect the generated HTML or run the app to confirm the display reads "Built at {timestamp}".
  </verify>
  <done>
Build timestamp displays as "Built at 2026-01-17 12:00:00 UTC" in the bottom-right corner.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Run `trunk serve` and open the application
2. Verify clock in menu bar shows format like "Fri 2:04:30 PM"
3. Watch clock for several seconds to confirm seconds increment
4. Verify bottom-right shows "Built at {timestamp}" with the prefix
5. Run `trunk build --release` to ensure production build works

All FIX-007, FIX-008, FIX-009 acceptance criteria must pass.
</verification>

<success_criteria>
- Clock format corrected: shows "H:MM:SS AM/PM" not "H PM:MM"
- Seconds visible in clock and updating every second
- Build timestamp prefixed with "Built at "
- All trunk builds succeed
- v1.1 System Polish milestone complete (all 9 fixes done)
</success_criteria>

<output>
After completion, create `.planning/phases/03-clock-display-fixes/03-01-SUMMARY.md` following the summary template.

Update STATE.md to reflect:
- Phase 03 complete
- v1.1 milestone complete
- All FIX requirements resolved
</output>
