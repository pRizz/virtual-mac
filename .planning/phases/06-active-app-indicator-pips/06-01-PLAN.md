---
phase: 06-active-app-indicator-pips
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/window_manager.rs, src/dock.rs, styles.css]
autonomous: false
---

<objective>
Fix dock indicator pips so they accurately represent running apps and visibly emphasize the active app.

Purpose: Ensure the dock communicates running vs active state reliably and matches macOS expectations.
Output: Updated dock indicator logic + styling, verified visually.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
@~/.config/opencode/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md
@.planning/phases/03-dock-state/03-01-SUMMARY.md
@src/window_manager.rs
@src/dock.rs
@styles.css
</context>

<tasks>
<task type="auto">
  <name>Task 1: Normalize active app tracking</name>
  <files>src/window_manager.rs</files>
  <action>Update the active-app sync Effect to derive the active app name from `app_type.to_string()` instead of window title. Keep the Finder fallback when no windows are active. This ensures the active app string matches dock pinned app names and menu bar expectations.</action>
  <verify>cargo clippy --all-targets --all-features -- -D warnings</verify>
  <done>Active app state uses app type names consistently and no clippy warnings appear.</done>
</task>

<task type="auto">
  <name>Task 2: Render running + active indicator pips</name>
  <files>src/dock.rs, styles.css</files>
  <action>Update dock indicator rendering to distinguish running vs active state. Use `system_state.open_windows` for running apps and `system_state.active_app` for the focused app. Emit indicator classes for running and active (e.g., `dock-indicator running` plus `active` when focused), and update CSS so running pips appear and the active pip is visually emphasized (larger/brightened). Keep indicators hidden for non-running apps, downloads, and trash.</action>
  <verify>cargo build --all-targets --all-features</verify>
  <done>Running apps show pips, the active app pip is visually distinct, and non-running apps show no pip.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Updated dock pip logic with active app emphasis</what-built>
  <how-to-verify>
    1. Run: `trunk serve`
    2. Open multiple apps (Finder, Terminal, Calculator).
    3. Switch focus between windows.
    4. Confirm running apps show pips and the active app pip is visually emphasized.
    5. Close an app and confirm its pip disappears.
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe what looks wrong.</resume-signal>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo fmt --all`
- [ ] `cargo clippy --all-targets --all-features -- -D warnings`
- [ ] `cargo build --all-targets --all-features`
- [ ] Manual verification of pip behavior passed
</verification>

<success_criteria>

- All tasks completed
- Active app tracking uses app type names
- Running apps display pips and active app pip is visually emphasized
- No lint/build errors introduced
  </success_criteria>

<output>
After completion, create `.planning/phases/06-active-app-indicator-pips/06-01-SUMMARY.md`
</output>
