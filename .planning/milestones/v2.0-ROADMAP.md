# Milestone v2.0: Persistence & Polish

**Status:** âœ… SHIPPED 2026-01-20
**Phases:** 1-5
**Total Plans:** 8

## Overview

State persistence across page refresh for Calculator, Terminal, TextEdit, and Dock, plus notification polish and the About VirtualMac dialog.

## Phases

### Phase 1: Calculator Persistence

**Goal**: Establish localStorage persistence patterns with the simplest app (Calculator) as the reference implementation.
**Depends on**: None
**Plans**: 1 plan

Plans:

- [x] 01-01: Add memory functionality and localStorage persistence

**Details:**
- Delivers: Calculator memory value (M+/M-/MR/MC) functionality; persistence infrastructure with save/load and schema versioning; `virtualmac_calculator` localStorage key
- Requirements covered: REQ-2 (Calculator State Persistence)
- Key files: `src/calculator.rs`
- Pattern: Follow Notes app component-level persistence pattern

### Phase 2: Terminal & TextEdit Persistence

**Goal**: Apply Phase 1 patterns to Terminal (command history, cwd) and TextEdit (document content).
**Depends on**: Phase 1
**Plans**: 3 plans

Plans:

- [x] 02-01: Terminal command history and cwd persistence
- [x] 02-02: TextEdit content and toolbar settings persistence
- [x] 02-03: Gap closure: TextEdit toolbar settings applied on mount

**Details:**
- Delivers: Terminal command history and cwd persistence; TextEdit document content persistence; TextEdit toolbar settings persistence; `virtualmac_terminal` and `virtualmac_textedit` localStorage keys
- Requirements covered: REQ-3 (Terminal), REQ-4 (TextEdit)
- Key files: `src/terminal.rs`, `src/textedit.rs`
- Dependencies: Phase 1 (persistence patterns established)

### Phase 3: Dock State

**Goal**: Ensure running indicators work correctly and add pinned apps persistence.
**Depends on**: Phase 1-2
**Plans**: 1 plan

Plans:

- [x] 03-01: Dock state persistence and running indicators

**Details:**
- Delivers: Verified dynamic running indicators (derive from WindowManager); pinned apps list persistence; `virtualmac_dock` localStorage key
- Requirements covered: REQ-5 (Dock State Persistence)
- Key files: `src/dock.rs`
- Research: Verified running indicator derivation from WindowManager/SystemState

### Phase 4: Notification Polish

**Goal**: Polish notification animations to match macOS Big Sur style with smooth entrance/exit animations, hover-to-pause, and click-to-dismiss.
**Depends on**: None
**Plans**: 2 plans

Plans:

- [x] 04-01: CSS animations and styling (entrance/exit, shadow, hover)
- [x] 04-02: Rust state management (exit state, hover pause, click dismiss, max 3)

**Details:**
- Delivers: Smooth entrance animation (400ms ease-out); slide-out exit animation (400ms ease-in); hover pause; click-to-dismiss; max 3 visible notifications; diffuse Big Sur shadow; app icon rendering; Terminal `notify` command
- Requirements covered: REQ-6 (Notification System Polish)
- Key files: `styles.css`, `src/notification.rs`, `src/terminal.rs`
- Dependencies: None (independent of persistence phases)

### Phase 5: About VirtualMac

**Goal**: Add About VirtualMac menu item and draggable dialog with version, links, and credits.
**Depends on**: None
**Plans**: 1 plan

Plans:

- [x] 05-01: Add AboutVirtualMac dialog with drag behavior and styling

**Details:**
- Delivers: About VirtualMac menu item; draggable dialog; version info; GitHub/live site/creator links; tool credits; creator attribution
- Requirements covered: REQ-1 (About VirtualMac Menu Item)
- Key files: `src/system_state.rs`, `src/menu_bar.rs`, `src/modals.rs`, `src/styles.css`
- Dependencies: None (modal system exists)

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**

- Persist only calculator memory value; keep display/operation transient
- Include schema_version on persisted state for future migrations
- Limit Terminal command history to 1000 entries; do not persist output history
- Use innerHTML + StoredValue for TextEdit content restore with toolbar settings applied after mount
- Persist only dock pinned apps; derive running indicators from open windows
- Use 400ms Big Sur-style notification animations with hover pause and max-3 queueing
- About VirtualMac dialog uses separate overlay and draggable titlebar

**Issues Resolved:**

- Fixed pre-existing clippy warnings that blocked milestone verification
- Applied TextEdit toolbar settings after content restoration to match UI state
- Smoothed notification exit collapse and reactive exiting state

**Issues Deferred:**

- None

**Technical Debt Incurred:**

- None

---

_For current project status, see .planning/ROADMAP.md_

---
