---
phase: 04-textedit-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/textedit.rs
  - styles.css
autonomous: true

must_haves:
  truths:
    - "User sees document as white page with shadow on gray background"
    - "User can change text color via color picker"
    - "User can highlight text with background color"
    - "Text cursor and selection have proper macOS styling"
  artifacts:
    - path: "styles.css"
      provides: "Document wrapper styling with page appearance"
      contains: "textedit-document-wrapper"
    - path: "src/textedit.rs"
      provides: "Color picker inputs in toolbar"
      contains: "foreColor"
  key_links:
    - from: "src/textedit.rs"
      to: "execCommand foreColor"
      via: "color input change handler"
      pattern: "foreColor"
    - from: "src/textedit.rs"
      to: "execCommand hiliteColor"
      via: "highlight input change handler"
      pattern: "hiliteColor"
---

<objective>
Add document-style appearance with white page on gray background, plus text and highlight color pickers.

Purpose: Cover REQ-004.2, REQ-004.7, REQ-004.9 - the visual polish that makes TextEdit feel like a real document editor.
Output: TextEdit with document-style layout and working color controls.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-textedit-polish/04-RESEARCH.md
@src/textedit.rs
@styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add document-style wrapper appearance</name>
  <files>src/textedit.rs, styles.css</files>
  <action>
    1. In textedit.rs, restructure the content area to have a wrapper and document:
       - Change the contenteditable div structure:
       ```rust
       // Before:
       <div class="textedit-content" contenteditable="true" ...>

       // After:
       <div class="textedit-document-wrapper">
           <div
               class="textedit-document"
               contenteditable="true"
               style=move || format!("font-size: {}px;", font_size.get())
           >
               "Start typing here..."
           </div>
       </div>
       ```

    2. In styles.css, add the document wrapper styling (per research CSS patterns):
       ```css
       /* Document wrapper - gray background, scrollable */
       .textedit-document-wrapper {
           flex: 1;
           overflow-y: auto;
           background: #e0e0e0;
           padding: 24px;
       }

       /* Document page - white page with shadow */
       .textedit-document {
           max-width: 8.5in;
           min-height: 11in;
           margin: 0 auto;
           background: white;
           box-shadow:
               0 1px 3px rgba(0, 0, 0, 0.12),
               0 1px 2px rgba(0, 0, 0, 0.24);
           padding: 1in;
           outline: none;
           line-height: 1.6;
           color: #1a1a1a;
           font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
       }

       .textedit-document:focus {
           outline: none;
       }
       ```

    3. Update the existing .textedit-content styles - we can remove or rename since we're replacing with document wrapper.

    4. Add dark mode support for the wrapper:
       ```css
       [data-theme="dark"] .textedit-document-wrapper {
           background: #3a3a3a;
       }

       [data-theme="dark"] .textedit-document {
           background: #2d2d2d;
           color: #e5e5e5;
           box-shadow:
               0 1px 3px rgba(0, 0, 0, 0.3),
               0 1px 2px rgba(0, 0, 0, 0.4);
       }
       ```
  </action>
  <verify>Run `trunk serve`, open TextEdit:
    - Gray background visible around document
    - White document page centered with shadow
    - Document has proper margins (~1 inch padding feel)
    - Document scrolls within wrapper when content overflows
    - Page looks like a real document, not just a text box</verify>
  <done>TextEdit displays as a document page on gray background with shadow</done>
</task>

<task type="auto">
  <name>Task 2: Add text and highlight color pickers</name>
  <files>src/textedit.rs, styles.css</files>
  <action>
    1. In textedit.rs, add color state signals:
       ```rust
       let (text_color, set_text_color) = signal("#000000".to_string());
       let (highlight_color, set_highlight_color) = signal("#ffff00".to_string());
       ```

    2. Create color change handlers:
       ```rust
       let on_text_color_change = move |e: web_sys::Event| {
           let target = e.target().unwrap();
           let input = target.dyn_into::<web_sys::HtmlInputElement>().unwrap();
           let color = input.value();
           set_text_color.set(color.clone());
           execCommand("foreColor", false, &color);
       };

       let on_highlight_change = move |e: web_sys::Event| {
           let target = e.target().unwrap();
           let input = target.dyn_into::<web_sys::HtmlInputElement>().unwrap();
           let color = input.value();
           set_highlight_color.set(color.clone());
           execCommand("hiliteColor", false, &color);
       };
       ```

    3. Add color picker inputs to toolbar (after alignment buttons):
       ```rust
       <div class="textedit-toolbar-separator"></div>
       <div class="textedit-toolbar-group">
           <div class="textedit-color-picker" title="Text Color">
               <span class="textedit-color-label">"A"</span>
               <input
                   type="color"
                   class="textedit-color-input"
                   value=move || text_color.get()
                   on:input=on_text_color_change
               />
           </div>
           <div class="textedit-color-picker" title="Highlight Color">
               <span class="textedit-color-label textedit-highlight-icon">"A"</span>
               <input
                   type="color"
                   class="textedit-color-input"
                   value=move || highlight_color.get()
                   on:input=on_highlight_change
               />
           </div>
       </div>
       ```

    4. In styles.css, add color picker styling (following research CSS patterns):
       ```css
       .textedit-color-picker {
           position: relative;
           display: flex;
           align-items: center;
           justify-content: center;
           width: 28px;
           height: 24px;
           border: 1px solid #c8c8c8;
           background: linear-gradient(180deg, #ffffff 0%, #f0f0f0 100%);
           border-radius: 4px;
           cursor: pointer;
           overflow: hidden;
       }

       .textedit-color-picker:hover {
           border-color: #b0b0b0;
       }

       .textedit-color-label {
           font-size: 14px;
           font-weight: 600;
           color: #333;
           pointer-events: none;
           z-index: 1;
       }

       .textedit-highlight-icon {
           background: #ffff00;
           padding: 0 3px;
           border-radius: 2px;
       }

       .textedit-color-input {
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           opacity: 0;
           cursor: pointer;
           border: none;
           padding: 0;
       }

       /* Show color swatch below the A */
       .textedit-color-picker::after {
           content: '';
           position: absolute;
           bottom: 2px;
           left: 4px;
           right: 4px;
           height: 3px;
           background: var(--text-color, #000000);
           border-radius: 1px;
       }
       ```

    5. Note: The native color input will show the browser's color picker when clicked. This is intentional - it's functional and accessible.
  </action>
  <verify>Run `trunk serve`, test:
    - Text color picker visible in toolbar (A with color bar)
    - Clicking text color opens native color picker
    - Selecting color applies to selected text
    - Highlight color picker visible (A with yellow background)
    - Clicking highlight opens color picker
    - Selecting color highlights selected text</verify>
  <done>TextEdit has functional text color and highlight color pickers</done>
</task>

<task type="auto">
  <name>Task 3: Add cursor and selection styling</name>
  <files>styles.css</files>
  <action>
    1. Add proper cursor styling for the document:
       ```css
       .textedit-document {
           cursor: text;
           caret-color: #000000;
       }

       [data-theme="dark"] .textedit-document {
           caret-color: #ffffff;
       }
       ```

    2. Add selection styling to match macOS:
       ```css
       .textedit-document::selection {
           background: #b4d5fe;
       }

       .textedit-document *::selection {
           background: #b4d5fe;
       }

       [data-theme="dark"] .textedit-document::selection {
           background: #3f638b;
       }

       [data-theme="dark"] .textedit-document *::selection {
           background: #3f638b;
       }
       ```

    3. Add scrollbar styling for the document wrapper:
       ```css
       .textedit-document-wrapper::-webkit-scrollbar {
           width: 10px;
       }

       .textedit-document-wrapper::-webkit-scrollbar-track {
           background: #f0f0f0;
       }

       .textedit-document-wrapper::-webkit-scrollbar-thumb {
           background: #c0c0c0;
           border-radius: 5px;
           border: 2px solid #f0f0f0;
       }

       .textedit-document-wrapper::-webkit-scrollbar-thumb:hover {
           background: #a0a0a0;
       }

       [data-theme="dark"] .textedit-document-wrapper::-webkit-scrollbar-track {
           background: #2d2d2d;
       }

       [data-theme="dark"] .textedit-document-wrapper::-webkit-scrollbar-thumb {
           background: #5a5a5a;
           border-color: #2d2d2d;
       }
       ```

    4. Ensure placeholder text styling:
       ```css
       .textedit-document:empty::before {
           content: "Start typing...";
           color: #999;
           pointer-events: none;
       }

       [data-theme="dark"] .textedit-document:empty::before {
           color: #666;
       }
       ```
  </action>
  <verify>Run `trunk serve`, test:
    - Text cursor appears as I-beam in document
    - Cursor blinks properly
    - Selecting text shows blue highlight (light mode: #b4d5fe)
    - Selection visible in dark mode too
    - Scrollbar styled to match macOS</verify>
  <done>TextEdit has proper cursor and selection styling matching macOS</done>
</task>

</tasks>

<verification>
1. Run `trunk serve` and open TextEdit
2. Verify document appears as white page on gray background
3. Verify page has shadow and proper margins
4. Test text color picker on selected text
5. Test highlight color picker on selected text
6. Verify cursor and selection styling
7. Test in dark mode if available
</verification>

<success_criteria>
- REQ-004.2 (document style) complete - white page with margins on gray bg
- REQ-004.7 (color pickers) complete - text and highlight colors work
- REQ-004.9 (cursor/selection) complete - proper macOS-style selection
</success_criteria>

<output>
After completion, create `.planning/phases/04-textedit-polish/04-02-SUMMARY.md`
</output>
