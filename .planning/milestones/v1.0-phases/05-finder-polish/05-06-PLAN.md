---
phase: 05-finder-polish
plan: 06
type: execute
wave: 3
depends_on:
  - "05-01"
  - "05-02"
  - "05-03"
  - "05-04"
  - "05-05"
files_modified:
  - src/finder.rs
  - styles.css
autonomous: false

must_haves:
  truths:
    - "Sidebar shows iCloud section with iCloud Drive item"
    - "Status bar shows selection count when items selected"
    - "Status bar shows available disk space"
    - "All view modes visually match macOS Finder"
    - "Search, path bar, and context menu work correctly"
  artifacts:
    - path: "src/finder.rs"
      provides: "Complete Finder with sidebar sections and status bar"
      contains: "iCloud"
    - path: "styles.css"
      provides: "Polished Finder styling"
      contains: ".finder"
  key_links:
    - from: "status bar display"
      to: "selected_items signal"
      via: "conditional rendering"
      pattern: "selected_items\\.get\\(\\)"
---

<objective>
Final polish for Finder: sidebar sections, status bar enhancements, and visual verification.

Purpose: Complete remaining REQ-005 items and verify overall Finder polish.
Output: Fully polished Finder matching macOS appearance.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-finder-polish/05-RESEARCH.md
@.planning/phases/05-finder-polish/05-01-SUMMARY.md
@.planning/phases/05-finder-polish/05-02-SUMMARY.md
@.planning/phases/05-finder-polish/05-03-SUMMARY.md
@.planning/phases/05-finder-polish/05-04-SUMMARY.md
@.planning/phases/05-finder-polish/05-05-SUMMARY.md

@src/finder.rs
@styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add iCloud and Tags sidebar sections</name>
  <files>src/finder.rs</files>
  <action>
Add iCloud and Tags sections to the sidebar for visual completeness.

1. Add iCloud section after Favorites:
```rust
// Sidebar iCloud items
let sidebar_icloud = vec![
    SidebarItem { name: "iCloud Drive", icon: "☁️", path: Some("/") },
];
```

2. Add Tags section (visual placeholder):
```rust
// Sidebar Tags (visual only - no functionality)
let sidebar_tags = vec![
    ("Red", "#ff3b30"),
    ("Orange", "#ff9500"),
    ("Yellow", "#ffcc00"),
    ("Green", "#34c759"),
    ("Blue", "#007aff"),
    ("Purple", "#af52de"),
    ("Gray", "#8e8e93"),
];
```

3. Render the iCloud section:
```rust
<div class="sidebar-section">
    <div class="sidebar-header">"iCloud"</div>
    {sidebar_icloud.into_iter().map(|item| {
        // Same rendering as favorites
    }).collect::<Vec<_>>()}
</div>
```

4. Render the Tags section:
```rust
<div class="sidebar-section">
    <div class="sidebar-header">"Tags"</div>
    {sidebar_tags.into_iter().map(|(name, color)| {
        view! {
            <div class="sidebar-item tag-item">
                <span class="sidebar-tag-dot" style:background=color></span>
                <span class="sidebar-name">{name}</span>
            </div>
        }
    }).collect::<Vec<_>>()}
</div>
```

5. Add CSS for tag dots:
```css
.sidebar-tag-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
}

.tag-item {
    cursor: default;
    opacity: 0.6;
}
```

Note: Tags are visual only - clicking them does nothing (acceptable for simulator).
  </action>
  <verify>Run `trunk serve`, verify sidebar shows Favorites, iCloud, Locations, Tags sections</verify>
  <done>Sidebar displays all macOS-style sections including iCloud and Tags</done>
</task>

<task type="auto">
  <name>Task 2: Enhance status bar with selection info and available space</name>
  <files>src/finder.rs</files>
  <action>
Update the status bar to show selection count when items are selected AND available disk space.

1. Update status bar rendering to include available space:
```rust
<div class="finder-statusbar">
    <div class="statusbar-left">
        {move || {
            let count = filtered_files.get().len();
            let selected = selected_items.get().len();

            if selected > 0 {
                format!("{} of {} selected", selected, count)
            } else {
                format!("{} items", count)
            }
        }}
    </div>
    <div class="statusbar-right">
        "128 GB available"
    </div>
</div>
```

2. Add CSS for status bar layout:
```css
.finder-statusbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 12px;
    /* ...existing styles... */
}

.statusbar-left,
.statusbar-right {
    font-size: 11px;
    color: #666;
}
```

The status bar should now dynamically show:
- Left side: "X items" when nothing selected, "Y of X selected" when items are selected
- Right side: "128 GB available" (hardcoded for simulator - real value would require filesystem API)

Note: The available space is a static placeholder since this is a simulated filesystem.
A real implementation would query the filesystem for actual available space.
  </action>
  <verify>Run `trunk serve`, verify status bar shows item count on left and "128 GB available" on right</verify>
  <done>Status bar shows item count, selection count, and available disk space</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification checkpoint</name>
  <what-built>
Complete Finder implementation with:
- View mode switching (Icon, List, Column, Gallery)
- Functional search filtering
- Path bar with breadcrumb navigation
- Context menu actions (New Folder, Rename, Move to Trash)
- Sidebar with Favorites, iCloud, Locations, Tags sections
- Status bar with item count, selection count, and available space
- Back/forward navigation buttons (already present)
  </what-built>
  <how-to-verify>
1. Run `trunk serve` and open Finder window
2. Test each view mode button - verify styling changes correctly
3. In Icon view: verify grid layout, icon sizes, selection highlighting
4. In List view: verify columns (Name, Date, Size, Kind), sorting appearance
5. In Column view: verify Miller columns behavior, folder expansion
6. Type in search field - verify files filter correctly
7. Check path bar - click segments to navigate
8. Right-click background - verify "New Folder" creates a folder
9. Right-click item - verify Rename and Move to Trash work
10. Check sidebar - verify all 4 sections visible (Favorites, iCloud, Locations, Tags)
11. Select items - verify status bar shows "X of Y selected" on left
12. Verify status bar shows "128 GB available" on right side
13. Test back/forward buttons - navigate into folder, click back, verify navigation
14. Compare overall appearance to macOS Finder screenshot

Expected: Finder should closely match macOS Finder appearance and behavior.
  </how-to-verify>
  <resume-signal>Type "approved" if Finder looks and works correctly, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
- Sidebar shows 4 sections: Favorites, iCloud, Locations, Tags
- Status bar displays selection count when items selected
- Status bar displays "128 GB available" on right side
- All view modes render correctly
- Search filters work across views
- Path bar navigation works
- Context menu actions work
- Back/forward navigation works
- Overall appearance matches macOS Finder
</verification>

<success_criteria>
- REQ-005.1: Sidebar styling matches macOS - COMPLETE
- REQ-005.2: Toolbar with view buttons, search, and back/forward - COMPLETE
- REQ-005.3: Icon view - COMPLETE
- REQ-005.4: List view with columns - COMPLETE
- REQ-005.5: Column view - COMPLETE
- REQ-005.6: Path bar - COMPLETE
- REQ-005.7: Status bar with item count and available space - COMPLETE
- REQ-005.8: Functional search - COMPLETE
- REQ-005.9: Context menu actions - COMPLETE
- REQ-005.10: Double-click navigation - COMPLETE
- REQ-005.11: File/folder icons - COMPLETE
- White padding bug - FIXED
</success_criteria>

<output>
After completion, create `.planning/phases/05-finder-polish/05-06-SUMMARY.md`
</output>
