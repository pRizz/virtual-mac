---
phase: 05-finder-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/finder.rs
  - styles.css
autonomous: true

must_haves:
  truths:
    - "Column view shows multiple columns side by side"
    - "Clicking a folder in column view shows its contents in the next column"
    - "Clicking a file in column view shows file info in preview column"
    - "Column view scrolls horizontally when many columns exist"
  artifacts:
    - path: "src/finder.rs"
      provides: "ColumnView component with Miller columns"
      contains: "finder-columns"
    - path: "styles.css"
      provides: "Column view styling"
      contains: ".finder-column"
  key_links:
    - from: "column item click"
      to: "column_paths signal"
      via: "set_column_paths"
      pattern: "set_column_paths"
---

<objective>
Implement the Column view (Miller columns) for Finder showing hierarchical navigation.

Purpose: REQ-005.5 requires column view navigation.
Output: Working ColumnView component with Miller columns behavior.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-finder-polish/05-RESEARCH.md

@src/finder.rs
@src/file_system.rs
@styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add column view state management</name>
  <files>src/finder.rs</files>
  <action>
Column view needs its own state to track the column history. Add signals for column view:

```rust
// Column paths tracks which paths are shown in each column
// e.g., ["/", "/Documents", "/Documents/Work"] shows 3 columns
let (column_paths, set_column_paths) = signal(vec![current_path.get()]);
```

When navigating in column view:
- Clicking a folder adds its path to column_paths
- Clicking an item in an earlier column truncates column_paths to that point + the new selection

Sync column_paths when current_path changes (from sidebar or other navigation):
```rust
// Effect to sync column_paths with current_path
Effect::new(move |_| {
    let path = current_path.get();
    let view = view_mode.get();
    if view == ViewMode::Column {
        // Build column paths from root to current path
        let mut paths = vec!["/".to_string()];
        let parts: Vec<&str> = path.split('/').filter(|s| !s.is_empty()).collect();
        let mut accumulated = String::new();
        for part in parts {
            accumulated = format!("{}/{}", accumulated, part);
            paths.push(accumulated.clone());
        }
        set_column_paths.set(paths);
    }
});
```

Note: Use Effect from leptos::prelude for the sync.
  </action>
  <verify>Build succeeds with `trunk build`</verify>
  <done>Column view state signals created and synced with current_path</done>
</task>

<task type="auto">
  <name>Task 2: Create ColumnView component</name>
  <files>src/finder.rs</files>
  <action>
Create the column view rendering inside the content area. Column view shows:
1. Multiple columns side by side
2. Each column shows contents of a directory
3. Selected item is highlighted
4. Folders show ">" indicator

Add to the view mode match:
```rust
ViewMode::Column => {
    view! {
        <div class="finder-columns">
            <For
                each=move || column_paths.get().into_iter().enumerate().collect::<Vec<_>>()
                key=|(idx, path)| format!("{}-{}", idx, path)
                children=move |(col_idx, col_path)| {
                    let fs = use_file_system();
                    let col_path_for_list = col_path.clone();
                    let items = move || {
                        let _ = fs.version.get();
                        fs.list_dir(&col_path_for_list)
                    };

                    // Determine which item is selected in this column (next column's parent)
                    let selected_in_col = move || {
                        let paths = column_paths.get();
                        paths.get(col_idx + 1).cloned()
                    };

                    view! {
                        <div class="finder-column">
                            <For
                                each=move || items()
                                key=|entry| entry.metadata.path.clone()
                                children=move |entry| {
                                    let path = entry.metadata.path.clone();
                                    let path_for_click = path.clone();
                                    let name = entry.metadata.name.clone();
                                    let icon = entry.metadata.icon.clone();
                                    let is_folder = entry.is_directory();

                                    let is_selected = move || {
                                        selected_in_col().map(|s| s == path).unwrap_or(false)
                                    };

                                    view! {
                                        <div
                                            class=move || {
                                                let mut cls = "finder-column-item".to_string();
                                                if is_selected() { cls.push_str(" selected"); }
                                                if is_folder { cls.push_str(" has-children"); }
                                                cls
                                            }
                                            on:click=move |_| {
                                                // Truncate columns to current + add this path if folder
                                                set_column_paths.update(|paths| {
                                                    paths.truncate(col_idx + 1);
                                                    if is_folder {
                                                        paths.push(path_for_click.clone());
                                                    }
                                                });
                                                // Update current_path and selection
                                                if is_folder {
                                                    set_current_path.set(path_for_click.clone());
                                                }
                                                set_selected_items.set(vec![name.clone()]);
                                            }
                                        >
                                            <span class="column-item-icon">{icon}</span>
                                            <span class="column-item-name">{name}</span>
                                        </div>
                                    }
                                }
                            />
                        </div>
                    }
                }
            />
        </div>
    }.into_any()
}
```

Note: Need to ensure fs is accessible inside the nested closures. May need to clone or use use_file_system() inside.
  </action>
  <verify>Run `trunk serve`, switch to Column view, verify columns display and clicking folders adds columns</verify>
  <done>ColumnView renders multiple columns, clicking folders expands to new columns</done>
</task>

<task type="auto">
  <name>Task 3: Add column view CSS styling</name>
  <files>styles.css</files>
  <action>
Add CSS for the column view (Miller columns) after list view styles:

```css
/* Finder Column View (Miller Columns) */
.finder-columns {
    display: flex;
    flex: 1;
    overflow-x: auto;
    overflow-y: hidden;
}

.finder-column {
    min-width: 200px;
    max-width: 250px;
    border-right: 1px solid var(--finder-sidebar-border);
    overflow-y: auto;
    flex-shrink: 0;
    background: var(--finder-bg);
}

.finder-column:last-child {
    border-right: none;
    flex: 1;
    max-width: none;
}

.finder-column-item {
    display: flex;
    align-items: center;
    padding: 6px 12px;
    cursor: pointer;
    gap: 8px;
    border-bottom: 1px solid transparent;
    transition: background-color 0.1s;
}

.finder-column-item:hover {
    background: var(--finder-hover);
}

.finder-column-item.selected {
    background: var(--finder-selected);
}

.finder-column-item.has-children::after {
    content: "â€º";
    margin-left: auto;
    color: var(--finder-text-muted);
    font-size: 14px;
    font-weight: bold;
}

.column-item-icon {
    font-size: 16px;
    width: 20px;
    text-align: center;
    flex-shrink: 0;
}

.column-item-name {
    font-size: 12px;
    color: var(--finder-text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1;
}

.finder-column-item.selected .column-item-name {
    color: var(--finder-accent);
    font-weight: 500;
}
```

Key styling features:
- Horizontal scrolling container
- Fixed-width columns except last one
- ">" chevron for folders
- Selection highlighting
- Smooth hover states
  </action>
  <verify>Run `trunk serve`, switch to Column view, verify styling matches macOS Finder column view</verify>
  <done>Column view has proper Miller columns styling</done>
</task>

</tasks>

<verification>
- `trunk build` completes without errors
- Column view shows multiple columns side by side
- Clicking a folder adds a new column showing its contents
- Clicking an item in an earlier column truncates and rebuilds columns
- Horizontal scroll works when many columns exist
- Styling matches macOS Finder column view
</verification>

<success_criteria>
- REQ-005.5 satisfied: Column view navigation works
- Miller columns behavior is correct (click expands, truncates properly)
- Visual appearance matches macOS Finder column view
</success_criteria>

<output>
After completion, create `.planning/phases/05-finder-polish/05-03-SUMMARY.md`
</output>
