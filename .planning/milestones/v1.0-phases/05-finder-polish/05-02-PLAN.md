---
phase: 05-finder-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/finder.rs
  - styles.css
autonomous: true

must_haves:
  truths:
    - "List view shows files in rows with columns"
    - "List view displays Name, Date Modified, Size, Kind columns"
    - "List view column headers are visible"
    - "Files can be selected in list view"
    - "Double-click opens folders in list view"
  artifacts:
    - path: "src/finder.rs"
      provides: "ListView component"
      contains: "finder-list"
    - path: "styles.css"
      provides: "List view styling"
      contains: ".finder-list"
  key_links:
    - from: "ListView component"
      to: "files Memo"
      via: "files prop or direct access"
      pattern: "files\\.get\\(\\)"
---

<objective>
Implement the List view for Finder showing files in a table format with columns.

Purpose: REQ-005.4 requires list view with Name, Date Modified, Size, Kind columns.
Output: Working ListView component and CSS styling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-finder-polish/05-RESEARCH.md

@src/finder.rs
@src/file_system.rs (FileMetadata has size, modified fields)
@styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ListView component structure</name>
  <files>src/finder.rs</files>
  <action>
Add a ListView helper function inside or alongside the Finder component. This will render files in a table-like format.

The ListView needs to:
1. Display a header row with column names: Name, Date Modified, Size, Kind
2. Display each file as a row with the corresponding data
3. Support selection (use the same selected_items signal)
4. Support double-click to navigate into folders

Use the existing files Memo for data. For date formatting, use a helper function that converts the f64 timestamp to readable format (e.g., "Jan 17, 2026").

For "Kind" column, derive from the file:
- Folders: "Folder"
- Files with extension: "{ext} Document" or similar
- Files without extension: "Document"

For Size column:
- Folders: "--"
- Files: format as KB, MB based on size

Create the component structure:
```rust
// Inside content area, conditionally render based on view_mode
{move || {
    let current_files = files.get();
    match view_mode.get() {
        ViewMode::List => view! {
            <div class="finder-list">
                <div class="finder-list-header">
                    <div class="list-col name">"Name"</div>
                    <div class="list-col date">"Date Modified"</div>
                    <div class="list-col size">"Size"</div>
                    <div class="list-col kind">"Kind"</div>
                </div>
                <div class="finder-list-body">
                    // Map over files to create rows
                </div>
            </div>
        }.into_any(),
        _ => view! { /* existing grid view */ }.into_any(),
    }
}}
```
  </action>
  <verify>Build succeeds with `trunk build`</verify>
  <done>ListView structure created with header and row rendering</done>
</task>

<task type="auto">
  <name>Task 2: Add list view row rendering with selection and navigation</name>
  <files>src/finder.rs</files>
  <action>
Complete the ListView by rendering file rows. Each row should:
1. Display the file icon + name in the Name column
2. Format and display the modified date
3. Format and display the size (or "--" for folders)
4. Display the kind

Add click handler for selection (same as icon view).
Add double-click handler for folder navigation (same as icon view).

For date formatting, add a helper function:
```rust
fn format_date(timestamp: f64) -> String {
    let date = js_sys::Date::new(&JsValue::from_f64(timestamp));
    let month = match date.get_month() {
        0 => "Jan", 1 => "Feb", 2 => "Mar", 3 => "Apr",
        4 => "May", 5 => "Jun", 6 => "Jul", 7 => "Aug",
        8 => "Sep", 9 => "Oct", 10 => "Nov", _ => "Dec",
    };
    format!("{} {}, {}", month, date.get_date(), date.get_full_year())
}
```

For size formatting:
```rust
fn format_size(size: usize) -> String {
    if size < 1024 {
        format!("{} bytes", size)
    } else if size < 1024 * 1024 {
        format!("{} KB", size / 1024)
    } else {
        format!("{} MB", size / (1024 * 1024))
    }
}
```

Row structure:
```rust
<div
    class=move || if is_selected() { "finder-list-row selected" } else { "finder-list-row" }
    on:click=move |_| toggle_selection(name.clone())
    on:dblclick=move |_| if is_folder { navigate_to(path.clone()) }
>
    <div class="list-col name">
        <span class="list-item-icon">{icon}</span>
        <span class="list-item-name">{name}</span>
    </div>
    <div class="list-col date">{format_date(modified)}</div>
    <div class="list-col size">{if is_folder { "--".to_string() } else { format_size(size) }}</div>
    <div class="list-col kind">{kind}</div>
</div>
```

Need to add wasm_bindgen import for JsValue if not already present.
  </action>
  <verify>Run `trunk serve`, switch to List view, verify files display in rows with all columns</verify>
  <done>List view rows display file information, selection and double-click work</done>
</task>

<task type="auto">
  <name>Task 3: Add list view CSS styling</name>
  <files>styles.css</files>
  <action>
Add CSS for the list view after the existing finder styles (around line 978):

```css
/* Finder List View */
.finder-list {
    display: flex;
    flex-direction: column;
    flex: 1;
    overflow: hidden;
}

.finder-list-header {
    display: flex;
    padding: 8px 16px;
    background: var(--finder-toolbar-end);
    border-bottom: 1px solid var(--finder-toolbar-border);
    font-size: 11px;
    font-weight: 600;
    color: var(--finder-text-secondary);
    user-select: none;
}

.finder-list-body {
    flex: 1;
    overflow-y: auto;
}

.finder-list-row {
    display: flex;
    padding: 6px 16px;
    align-items: center;
    border-bottom: 1px solid var(--finder-hover);
    cursor: pointer;
    transition: background-color 0.1s;
}

.finder-list-row:hover {
    background: var(--finder-hover);
}

.finder-list-row.selected {
    background: var(--finder-selected);
}

.list-col {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 12px;
    color: var(--finder-text);
}

.list-col.name {
    flex: 2;
    display: flex;
    align-items: center;
    gap: 8px;
}

.list-col.date {
    flex: 1;
    min-width: 120px;
    color: var(--finder-text-secondary);
}

.list-col.size {
    flex: 0 0 80px;
    text-align: right;
    color: var(--finder-text-secondary);
}

.list-col.kind {
    flex: 0 0 100px;
    color: var(--finder-text-secondary);
}

.list-item-icon {
    font-size: 16px;
    width: 20px;
    text-align: center;
}

.list-item-name {
    overflow: hidden;
    text-overflow: ellipsis;
}

.finder-list-row.selected .list-item-name {
    color: var(--finder-accent);
    font-weight: 500;
}
```

Ensure the styling matches macOS Finder list view appearance:
- Light header background
- Alternating or bordered rows
- Proper column widths
- Selection highlighting
  </action>
  <verify>Run `trunk serve`, switch to List view, verify styling matches macOS Finder list view</verify>
  <done>List view has proper macOS-style styling with columns and selection</done>
</task>

</tasks>

<verification>
- `trunk build` completes without errors
- List view shows header row with column names
- List view shows file rows with Name, Date, Size, Kind
- Clicking a row selects it
- Double-clicking a folder navigates into it
- Styling matches macOS Finder list view
</verification>

<success_criteria>
- REQ-005.4 satisfied: List view with columns (Name, Date Modified, Size, Kind)
- List view is functional (selection, navigation)
- Visual appearance matches macOS Finder
</success_criteria>

<output>
After completion, create `.planning/phases/05-finder-polish/05-02-SUMMARY.md`
</output>
